<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="¶Brief intro ¶Linux ZBD ioctls Zoned block devices I&#x2F;O: zone types: conventional, support sequential writes, not support sequential writes. zone state: empty, implicit open, explicit open, closed, ful">
<meta property="og:type" content="article">
<meta property="og:title" content="Zoned Storage">
<meta property="og:url" content="https://sgzerolc.github.io/sg/2022/04/17/storages_zones/index.html">
<meta property="og:site_name" content="steins gate zero">
<meta property="og:description" content="¶Brief intro ¶Linux ZBD ioctls Zoned block devices I&#x2F;O: zone types: conventional, support sequential writes, not support sequential writes. zone state: empty, implicit open, explicit open, closed, ful">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sgzerolc.github.io/sg/2022/04/17/storages_zones/Screenshot-9834466.png">
<meta property="og:image" content="https://sgzerolc.github.io/sg/2022/04/17/storages_zones/Screenshot-9994087.png">
<meta property="article:published_time" content="2022-04-16T16:00:00.000Z">
<meta property="article:modified_time" content="2022-04-22T03:52:08.537Z">
<meta property="article:author" content="Sam Li">
<meta property="article:tag" content="code reading">
<meta property="article:tag" content="storage systems">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sgzerolc.github.io/sg/2022/04/17/storages_zones/Screenshot-9834466.png">
    
    
      
        
          <link rel="shortcut icon" href="/sg/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/sg/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/sg/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Zoned Storage</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/sg/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/sg/">Home</a></li><!--
     --><!--
       --><li><a href="/sg/about/">About</a></li><!--
     --><!--
       --><li><a href="/sg/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/sg/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/sg/CV/">CV</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/sg/2022/04/23/ex-cpp/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/sg/2022/04/15/qemu-develop/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&text=Zoned Storage"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&is_video=false&description=Zoned Storage"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zoned Storage&body=Check out this article: https://sgzerolc.github.io/sg/2022/04/17/storages_zones/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&name=Zoned Storage&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&t=Zoned Storage"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Brief-intro-v2"><span class="toc-number">1.</span> <span class="toc-text">Brief intro</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-ZBD-ioctls-v2"><span class="toc-number">1.1.</span> <span class="toc-text">Linux ZBD ioctls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Block-device-virtio-blk-v2"><span class="toc-number">1.2.</span> <span class="toc-text">Block device: virtio-blk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zoned-storage-v2"><span class="toc-number">1.3.</span> <span class="toc-text">Zoned storage</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Zoned Storage
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Sam Li</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-04-16T16:00:00.000Z" itemprop="datePublished">2022-04-17</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/sg/categories/computer-systems/">computer systems</a> › <a class="category-link" href="/sg/categories/computer-systems/storage-systems/">storage systems</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/sg/tags/code-reading/" rel="tag">code reading</a>, <a class="tag-link-link" href="/sg/tags/storage-systems/" rel="tag">storage systems</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Brief-intro-v2"><a class="header-anchor" href="#Brief-intro-v2">¶</a>Brief intro</h2>
<h3 id="Linux-ZBD-ioctls-v2"><a class="header-anchor" href="#Linux-ZBD-ioctls-v2">¶</a>Linux ZBD ioctls</h3>
<p>Zoned block devices I/O:</p>
<p>zone types: conventional, support sequential writes, not support sequential writes.</p>
<p>zone state: empty, implicit open, explicit open, closed, full, read only, offline.</p>
<ul>
<li>? Explicit /implicit open</li>
</ul>
<p>feature flags of reported zone descriptors</p>
<p>Zoned block device ioctl: report zone, reset zone, get zone, get number of zone, open zone, close zone, finish zone</p>
<p>three struct: block zone, to report, range</p>
<h3 id="Block-device-virtio-blk-v2"><a class="header-anchor" href="#Block-device-virtio-blk-v2">¶</a>Block device: virtio-blk</h3>
<ol>
<li>
<p>how to add QEMU block layer APIs for the Linux ZBD ioctls?</p>
<p>new block layer APIs to perform <strong>zoned device I/O</strong> on behalf of the guest</p>
</li>
<li>
<p>the virtio-blk device specification to understand how read, write, and other commands are sent on the request virtqueue and device parameters are reported from the Device Configuration Space. Zoned commands will work much in the same way.</p>
</li>
</ol>
<h3 id="Zoned-storage-v2"><a class="header-anchor" href="#Zoned-storage-v2">¶</a>Zoned storage</h3>
<ol>
<li>
<p>SSD and HDD differs in handling data writes:</p>
<ul>
<li>HDD writes data on empty spaces</li>
<li>SSD erases data first before it writes new data inside the Flash storage chips(data blocks and pages).Block sizes of an SSD are fixed, for example, 512kb, to 4MB while a page has 4kb of data</li>
<li>when one page is rewritten, the whole block will be erased and write again. Expensive writes in SSD lead to write amplification.</li>
</ul>
</li>
<li>
<p>common standard of zoned storage: SCSI (ZBC) and ZAC on SMR HDDs, NVMe ZNS on SSD</p>
<img src="/sg/2022/04/17/storages_zones/Screenshot-9834466.png" class="" title="Screenshot-9834466">
</li>
<li>
<p>NVMe ZNS SSDs: it can be read in any order but written sequentially.</p>
<ul>
<li>convential SSDs support random writes.</li>
<li>Different improving data repacement leads to higher write throughput, lower Qos, and increased capacity.</li>
</ul>
<img src="/sg/2022/04/17/storages_zones/Screenshot-9994087.png" class="" title="Screenshot-9994087">
</li>
</ol>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/sg/">Home</a></li>
         
          <li><a href="/sg/about/">About</a></li>
         
          <li><a href="/sg/categories/">Category</a></li>
         
          <li><a href="/sg/archives/">Writing</a></li>
         
          <li><a href="/sg/CV/">CV</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Brief-intro-v2"><span class="toc-number">1.</span> <span class="toc-text">Brief intro</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-ZBD-ioctls-v2"><span class="toc-number">1.1.</span> <span class="toc-text">Linux ZBD ioctls</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Block-device-virtio-blk-v2"><span class="toc-number">1.2.</span> <span class="toc-text">Block device: virtio-blk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zoned-storage-v2"><span class="toc-number">1.3.</span> <span class="toc-text">Zoned storage</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&text=Zoned Storage"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&is_video=false&description=Zoned Storage"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zoned Storage&body=Check out this article: https://sgzerolc.github.io/sg/2022/04/17/storages_zones/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&title=Zoned Storage"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&name=Zoned Storage&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://sgzerolc.github.io/sg/2022/04/17/storages_zones/&t=Zoned Storage"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022
    Sam Li
  </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/sg/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
